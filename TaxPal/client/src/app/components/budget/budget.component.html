<div class="budget-page">
    <!-- Profile Avatar in top right corner -->
    <div class="hero-user-profile">
        <button type="button" class="profile-avatar" (click)="toggleProfileMenu()">
            <span>{{ userInitial }}</span>
        </button>
        <div class="profile-menu-dropdown" *ngIf="showProfileMenu">
            <div class="profile-section">
                <div class="profile-info centered-profile">
                    <h3>{{ userName || 'User' }}</h3>
                    <p>{{ userEmail }}</p>
                </div>
            </div>
            <div class="profile-menu-divider"></div>
            <div class="profile-menu-items">
                <a routerLink="/user-profile" class="profile-menu-item" (click)="closeProfileMenu()">
                    <!-- ...dashboard icon svg... -->
                    <span>Dashboard</span>
                </a>
                <a routerLink="/profile-settings" class="profile-menu-item" (click)="closeProfileMenu()">
                    <!-- ...settings icon svg... -->
                    <span>Profile Settings</span>
                </a>
                <div class="profile-menu-divider"></div>
                <button type="button" class="profile-menu-item logout-item" (click)="logout()">
                    <!-- ...logout icon svg... -->
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </div>

    <main class="budget-main">
        <div class="budget-container">
            <!-- Form Section - Left side -->
            <div class="form-section">
                <div class="form-card" role="dialog" aria-labelledby="createBudgetTitle" aria-modal="true">
                    <div class="form-card-header">
                        <h2 id="createBudgetTitle" class="form-card-title">Create New Budget</h2>
                    </div>

                    <!-- Display error message if any -->
                    <div class="error-alert" *ngIf="error">{{ error }}</div>

                    <form class="budget-form" [formGroup]="form" (ngSubmit)="onSubmit()" autocomplete="off">
                        <!-- Amount field -->
                        <div class="form-group">
                            <label for="amount">Budget Amount</label>
                            <div class="currency-wrap">
                                <span class="currency-prefix">$</span>
                                <input 
                                    id="amount" 
                                    type="number" 
                                    step="0.01" 
                                    min="0.01" 
                                    placeholder="0.00"
                                    class="input pl-currency" 
                                    formControlName="amount" 
                                    required />
                            </div>
                            <span 
                                class="error-message" 
                                *ngIf="form.get('amount')?.invalid && form.get('amount')?.touched">
                                Please enter a valid amount greater than 0
                            </span>
                        </div>

                        <!-- Category field -->
                        <div class="form-group">
                            <label for="category">Category</label>
                            <select 
                                id="category" 
                                class="input" 
                                formControlName="category" 
                                required>
                                <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
                            </select>
                        </div>

                        <!-- Date field -->
                        <div class="form-group">
                            <label for="date">Budget Date</label>
                            <input 
                                id="date" 
                                type="date" 
                                class="input" 
                                formControlName="date" 
                                required />
                        </div>

                        <!-- Description field -->
                        <div class="form-group">
                            <label for="description">Description (optional)</label>
                            <textarea 
                                id="description" 
                                class="input" 
                                formControlName="description"
                                rows="3"
                                placeholder="Enter any additional notes..."></textarea>
                            <span 
                                class="error-message" 
                                *ngIf="form.get('description')?.invalid">
                                Description cannot exceed 200 characters
                            </span>
                        </div>

                        <div class="actions">
                            <a routerLink="/user-profile" class="btn btn-ghost">Cancel</a>
                            <button 
                                type="submit" 
                                class="btn btn-primary"
                                [disabled]="form.invalid || loading">
                                <span *ngIf="loading">Creating...</span>
                                <span *ngIf="!loading">Create Budget</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Budgets List - Right side -->
            <div class="budget-list-section">
                <div class="form-card">
                    <div class="form-card-header">
                        <h2 class="form-card-title">Your Budgets</h2>
                    </div>
                    <div class="budget-form" style="padding-top:16px">
                        <!-- Loading state -->
                        <div *ngIf="loading" class="loading-indicator">Loading budgets...</div>
                        
                        <!-- Error state -->
                        <div *ngIf="error" class="error-message">{{ error }}</div>
                        
                        <!-- Empty state -->
                        <div *ngIf="!loading && !budgets?.length" class="empty-state">
                            No budgets found. Create your first budget using the form.
                        </div>
                        
                        <!-- Budget table -->
                        <div class="budget-table-simple" *ngIf="!loading && budgets?.length">
                            <div class="budget-row budget-head">
                                <div>Amount</div>
                                <div>Category</div>
                                <div>Date</div>
                                <div>Description</div>
                                <div>Action</div>
                            </div>
                            <div class="budget-row" *ngFor="let b of budgets">
                                <div>${{ b.amount | number:'1.2-2' }}</div>
                                <div>{{ b.category }}</div>
                                <div>{{ b.date | date:'MMM dd, yyyy' }}</div>
                                <div class="budget-description">{{ b.description }}</div>
                                <div class="budget-action">
                                    <button class="delete-budget-btn" (click)="deleteBudget(b._id)" title="Delete budget">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="3 6 5 6 21 6"></polyline>
                                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m5 0V4a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v2"></path>
                                            <line x1="10" y1="11" x2="10" y2="17"></line>
                                            <line x1="14" y1="11" x2="14" y2="17"></line>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>